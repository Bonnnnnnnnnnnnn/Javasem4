<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{customer/layout/head_customer}"></head>
<style>
		.notification {
			display:none;
		    position: fixed;
		    top: 20px; /* khoảng cách từ trên */
		    right: 20px; /* khoảng cách từ bên phải */
		    background-color: #FFD333; /* màu nền */
		    color: black; /* màu chữ */
		    padding: 15px; /* khoảng cách bên trong */
		    border-radius: 5px; /* bo góc */
		    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); /* đổ bóng */
		    transform: translateX(100%); 
		    opacity: 0;
		    z-index: 1000;
		    animation : slideleft 4s;
		}
		@keyframes slideleft{
			0%{
			transform: translateX(100%); 
			opacity: 0;
			}
			50%{
			transform: translateX(0); 
			opacity: 1;
			}
			100%{
			transform: translateX(100%); 
			opacity: 0;
			}
		}
		
		
		
</style>
<body>

  	<div th:replace="~{customer/layout/header_customer}"></div>

   	 <!-- Breadcrumb Start -->

    <div class="container-fluid">
        <div class="row px-xl-5">
            <div class="col-12">
                <nav class="breadcrumb bg-light mb-30">
                    <a class="breadcrumb-item text-dark" href="/">Home</a>
                    <a class="breadcrumb-item text-dark" href="/shoppingpage/reset">Shop</a>
                    <span class="breadcrumb-item active">Shop Detail</span>
                </nav>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->


    <!-- Shop Detail Start -->
    <div class="container-fluid pb-5">
        <div class="row px-xl-5">
            <div class="col-lg-5 mb-30">
                <div id="product-carousel" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner bg-light">
                        <div class="carousel-item active">
                            <img class="w-100 h-100 " th:if="${product != null}" th:src="'/uploads/'+${product.Img}" alt="Image">
                        </div>
                       
                    </div>
                    <a class="carousel-control-prev" href="#product-carousel" data-slide="prev">
                        <i class="fa fa-2x fa-angle-left text-dark"></i>
                    </a>
                    <a class="carousel-control-next" href="#product-carousel" data-slide="next">
                        <i class="fa fa-2x fa-angle-right text-dark"></i>
                    </a>
                </div>
            </div>

            <div class="col-lg-7 h-auto mb-30">
                <div class="h-100 bg-light p-30">
                    <h3 th:text="${product.Product_name}"></h3>
                   <div class="d-flex mb-3">
    <div class="text-primary mr-2">
        <th:block th:with="rating=${product.averageRating}">
            <!-- Rating từ 1-5 -->
            <th:block th:if="${rating >= 1}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 0.5 && rating < 1}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 0.5}"><small class="far fa-star"></small></th:block>
            
            <th:block th:if="${rating >= 2}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 1.5 && rating < 2}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 1.5}"><small class="far fa-star"></small></th:block>
            
            <th:block th:if="${rating >= 3}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 2.5 && rating < 3}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 2.5}"><small class="far fa-star"></small></th:block>
            
            <th:block th:if="${rating >= 4}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 3.5 && rating < 4}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 3.5}"><small class="far fa-star"></small></th:block>
            
            <th:block th:if="${rating >= 5}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 4.5 && rating < 5}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 4.5}"><small class="far fa-star"></small></th:block>
        </th:block>
    </div>
    <small class="pt-1">
        (<span th:text="${product.totalFeedbacks}">0</span> Reviews)
    </small>
</div>
                    <h3 class="font-weight-semi-bold mb-4" th:text="'$' + ${product.Price}" ></h3>
                    <div style="min-height:50px; max-height:160px;overflow:auto;">
                    <p th:each="item : ${list_spe}" style="margin-bottom:10px;" ><span th:text="${item.Name_spe}"></span> : <span th:text=" ${item.Des_spe}"></span></p>
                    </div>
                    
                   <!--  <div class="d-flex mb-3">
                        <strong class="text-dark mr-3">Sizes:</strong>
                    </div> -->
                    <!-- <div class="d-flex mb-4">
                        <strong class="text-dark mr-3">Colors:</strong>
                        <form>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" class="custom-control-input" id="color-1" name="color">
                                <label class="custom-control-label" for="color-1">Black</label>
                            </div>
                           
                        </form>
                    </div> -->
                    <div class="d-flex align-items-center mb-4 pt-2">
                       <div class="input-group" style="width: 100px;">
						            <div class="input-group-btn">
						                <div th:onclick="minusFromCart()" 
									         class="btn-sm btn-primary">
									        <i class="fa fa-minus"></i>
									    </div> 	
						            </div>
						            <input type="text" class="form-control form-control-sm bg-secondary border-0 text-center"
						            		id = "quantitytocart"
						                  	value = "1"
						                  	readonly /> 
						                 <div class="input-group-btn">
								            <div th:onclick="updateQuantity()" 
										         class="btn-sm btn-primary">
										        <i class="fa fa-plus"></i>
										    </div>
								     	</div>
						        </div>
                        
                    </div>
                     <div class="d-flex align-items-center mb-4 pt-2">
                     	<button th:if="${product.status != 'OutOfStock'}" th:onclick="'addtocarttttt(' + ${product.Id} + ')'"  class="btn btn-primary px-3"><i class="fa fa-shopping-cart mr-1"></i> Add To Cart</button>
                     	<button th:if="${product.status == 'OutOfStock'}" style="background-color: #fcf0be;border-color: #545b62;color:black;" class="btn px-3"> Out of stock</button>
                     </div>
                </div>
            </div>
        </div>
        <div class="row px-xl-5">
            <div class="col">
                <div class="bg-light p-30">
                    <div class="nav nav-tabs mb-4">
                        <a class="nav-item nav-link text-dark active" data-toggle="tab" href="#tab-pane-1">Description</a>
                        <!-- <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-2">Information</a> -->
                        <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-2">Reviews</a>
                    </div>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="tab-pane-1">
                            <h4 class="mb-3">Product Description</h4>
                             <p th:text="${product.Description}"></p>
                        </div>
                       <div class="tab-pane fade" id="tab-pane-2">
    <h4 class="mb-3">Customer Reviews 
    <div class="row">
    <div class="col-3">
    <div class="d-flex mb-3">
    <div class="text-primary mr-2">
        <th:block th:with="rating=${product.averageRating}">
            <!-- Rating từ 1-5 -->
            <th:block th:if="${rating >= 1}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 0.5 && rating < 1}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 0.5}"><small class="far fa-star"></small></th:block>
            
            <th:block th:if="${rating >= 2}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 1.5 && rating < 2}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 1.5}"><small class="far fa-star"></small></th:block>
            
            <th:block th:if="${rating >= 3}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 2.5 && rating < 3}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 2.5}"><small class="far fa-star"></small></th:block>
            
            <th:block th:if="${rating >= 4}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 3.5 && rating < 4}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 3.5}"><small class="far fa-star"></small></th:block>
            
            <th:block th:if="${rating >= 5}"><small class="fas fa-star"></small></th:block>
            <th:block th:if="${rating >= 4.5 && rating < 5}"><small class="fas fa-star-half-alt"></small></th:block>
            <th:block th:if="${rating < 4.5}"><small class="far fa-star"></small></th:block>
        </th:block>
    </div>
    <small class="pt-1">
        (<span th:text="${product.totalFeedbacks}"></span> Reviews)
    </small>
</div>
    </div>
    </div>
        
    </h4>
    <h5>Feedbacks comment</h5>
    <div class="feedback-scroll" style="max-height: 400px; overflow-y: auto;">
        <div th:if="${not #lists.isEmpty(product.feedbacks)}" class="row">
            <div class="col-md-12">
                <div class="list-group">
                    <div th:each="feedback : ${product.feedbacks}" 
                         class="list-group-item mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-1" th:text="${feedback.customerName}"></h6>
                            <small th:text="${#temporals.format(feedback.created_Date, 'dd-MM-yyyy')}">Date</small>
                        </div>
                        
                        <!-- Rating stars -->
                        <div class="text-primary mb-2">
                            <th:block th:with="rate=${feedback.rating}">
                                <!-- Rating từ 1-5 -->
                                <th:block th:if="${rate >= 1}"><small class="fas fa-star"></small></th:block>
                                <th:block th:if="${rate < 1}"><small class="far fa-star"></small></th:block>
                                
                                <th:block th:if="${rate >= 2}"><small class="fas fa-star"></small></th:block>
                                <th:block th:if="${rate < 2}"><small class="far fa-star"></small></th:block>
                                
                                <th:block th:if="${rate >= 3}"><small class="fas fa-star"></small></th:block>
                                <th:block th:if="${rate < 3}"><small class="far fa-star"></small></th:block>
                                
                                <th:block th:if="${rate >= 4}"><small class="fas fa-star"></small></th:block>
                                <th:block th:if="${rate < 4}"><small class="far fa-star"></small></th:block>
                                
                                <th:block th:if="${rate >= 5}"><small class="fas fa-star"></small></th:block>
                                <th:block th:if="${rate < 5}"><small class="far fa-star"></small></th:block>
                            </th:block>
                        </div>
                        
                        <p class="mb-1" th:text="${feedback.comment}">Comment</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div th:if="${#lists.isEmpty(product.feedbacks.?[comment != null && !comment.isEmpty()])}" 
             class="text-center py-4">
            <p class="text-muted">No reviews yet. Be the first to review this product!</p>
        </div>
    </div>
</div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Shop Detail End -->


    <!-- Products Start -->
    <div class="container-fluid py-5">
        <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4"><span class="bg-secondary pr-3">Products of the same category</span></h2>
        <div class="row px-xl-5">
            <div class="col">
                <div class="owl-carousel related-carousel">
                    <div class="product-item bg-light" th:each="item : ${list_procate}" >
                        <div class="product-img position-relative overflow-hidden">
                            <img class="img-fluid w-100" th:src="'/uploads/' + ${item.Img}" alt="">
                            <div class="product-action">
                               <a class="btn btn-outline-dark btn-square" th:if="${item.status != 'OutOfStock'}" th:onclick="'addToCart(' + ${item.Id} + ')'">
							        <i class="fa fa-shopping-cart"></i>
							    </a>
							    <span th:if="${item.Status == 'OutOfStock'}" class="out-of-stock-message">Out of stock</span>
                            </div>
                        </div>
                        <div class="text-center py-4">
                            <a class="h6 text-decoration-none text-truncate" th:href="@{'/detailproduct/product?id=' + ${item.Id}}" th:text="${item.Product_name}"></a>
                            <div class="d-flex align-items-center justify-content-center mt-2">
                                 <h5 th:text="'$' + ${item.Price}"></h5>
                            </div>
                            <div class="d-flex align-items-center justify-content-center mb-1">
							    <div class="text-primary mr-2">
							        <th:block th:with="rating=${item.averageRating}">
							            <!-- Rating từ 1-5 -->
							            <th:block th:if="${rating >= 1}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 0.5 && rating < 1}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 0.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 2}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 1.5 && rating < 2}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 1.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 3}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 2.5 && rating < 3}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 2.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 4}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 3.5 && rating < 4}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 3.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 5}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 4.5 && rating < 5}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 4.5}"><small class="far fa-star"></small></th:block>
							        </th:block>
							    </div>
							    <small class="pt-1">
							        (<span th:text="${item.totalFeedbacks}">0</span>)
							    </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Products End -->

<div class="container-fluid py-5">
        <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4"><span class="bg-secondary pr-3">Products of the same brand</span></h2>
        <div class="row px-xl-5">
            <div class="col">
                <div class="owl-carousel related-carousel">
                    <div class="product-item bg-light" th:each="item : ${list_probrands}" >
                        <div class="product-img position-relative overflow-hidden">
                            <img class="img-fluid w-100" th:src="'/uploads/' + ${item.Img}" alt="">
                            <div class="product-action">
                               <a class="btn btn-outline-dark btn-square" th:if="${item.status != 'OutOfStock'}" th:onclick="'addToCart(' + ${item.Id} + ')'">
							        <i class="fa fa-shopping-cart"></i>
							    </a>
							    <span th:if="${item.Status == 'OutOfStock'}" class="out-of-stock-message">Out of stock</span>
                            </div>
                        </div>
                        <div class="text-center py-4">
                            <a class="h6 text-decoration-none text-truncate" th:href="@{'/detailproduct/product?id=' + ${item.Id}}" th:text="${item.Product_name}"></a>
                            <div class="d-flex align-items-center justify-content-center mt-2">
                                 <h5 th:text="'$' + ${item.Price}"></h5>
                            </div>
                            <div class="d-flex align-items-center justify-content-center mb-1">
							    <div class="text-primary mr-2">
							        <th:block th:with="rating=${item.averageRating}">
							            <!-- Rating từ 1-5 -->
							            <th:block th:if="${rating >= 1}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 0.5 && rating < 1}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 0.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 2}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 1.5 && rating < 2}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 1.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 3}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 2.5 && rating < 3}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 2.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 4}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 3.5 && rating < 4}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 3.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 5}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 4.5 && rating < 5}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 4.5}"><small class="far fa-star"></small></th:block>
							        </th:block>
							    </div>
							    <small class="pt-1">
							        (<span th:text="${item.totalFeedbacks}">0</span>)
							    </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<div class="container-fluid py-5">
        <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4"><span class="bg-secondary pr-3">Other products</span></h2>
        <div class="row px-xl-5">
            <div class="col">
                <div class="owl-carousel related-carousel">
                    <div class="product-item bg-light" th:each="item : ${list_proother}" >
                        <div class="product-img position-relative overflow-hidden">
                            <img class="img-fluid w-100" th:src="'/uploads/' + ${item.Img}" alt="">
                            <div class="product-action">
                               <a class="btn btn-outline-dark btn-square" th:if="${item.status != 'OutOfStock'}" th:onclick="'addToCart(' + ${item.Id} + ')'">
							        <i class="fa fa-shopping-cart"></i>
							    </a>
							    <span th:if="${item.Status == 'OutOfStock'}" class="out-of-stock-message">Out of stock</span>
                            </div>
                        </div>
                        <div class="text-center py-4">
                            <a class="h6 text-decoration-none text-truncate" th:href="@{'/detailproduct/product?id=' + ${item.Id}}" th:text="${item.Product_name}"></a>
                            <div class="d-flex align-items-center justify-content-center mt-2">
                                 <h5 th:text="'$' + ${item.Price}"></h5>
                            </div>
                            <div class="d-flex align-items-center justify-content-center mb-1">
							    <div class="text-primary mr-2">
							        <th:block th:with="rating=${item.averageRating}">
							            <!-- Rating từ 1-5 -->
							            <th:block th:if="${rating >= 1}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 0.5 && rating < 1}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 0.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 2}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 1.5 && rating < 2}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 1.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 3}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 2.5 && rating < 3}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 2.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 4}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 3.5 && rating < 4}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 3.5}"><small class="far fa-star"></small></th:block>
							            
							            <th:block th:if="${rating >= 5}"><small class="fas fa-star"></small></th:block>
							            <th:block th:if="${rating >= 4.5 && rating < 5}"><small class="fas fa-star-half-alt"></small></th:block>
							            <th:block th:if="${rating < 4.5}"><small class="far fa-star"></small></th:block>
							        </th:block>
							    </div>
							    <small class="pt-1">
							        (<span th:text="${item.totalFeedbacks}">0</span>)
							    </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Start -->
   <div th:replace="~{customer/layout/footer_customer}"></div>
    <!-- Footer End -->
<div id="cartNotification" class="notification" >
    <p>The product has been added to the cart successfully!</p>
</div>
    
</body>
<script>
function showNotification() {
	const notification = document.getElementById('cartNotification');
	// Đặt display thành none để ẩn thông báo
    notification.style.display = 'none';
    
    // Đợi một chút trước khi hiển thị lại thông báo
    setTimeout(() => {
        notification.style.display = 'block'; // Thiết lập display thành block
        notification.classList.add('show'); // Thêm class show để hiển thị animation
    }, 10); // Thời gian chờ rất ngắn (10ms) để trình duyệt nhận thấy sự thay đổi
    
   
}
function updateQuantity() {
	const quantityInput = $(`#quantitytocart`);
	var currentQuantity = parseInt(quantityInput.val());
		currentQuantity++;
        quantityInput.val(currentQuantity);
   
}
function minusFromCart() {
	const quantityInput = $(`#quantitytocart`);
	var currentQuantity = parseInt(quantityInput.val());
	if (currentQuantity > 1) {
		 currentQuantity--; 
	        quantityInput.val(currentQuantity);
    } 
   
}
function addtocarttttt(proid){
	const quantityInput = $(`#quantitytocart`);
	var currentQuantity = parseInt(quantityInput.val());
	$.ajax({
        url: '/cart/addtocartwq', // Đường dẫn đến endpoint
        type: 'POST', 
        data: { id: proid,
        		quantity : currentQuantity}, 
        success: function(response) {
        	const jsonResponse = JSON.parse(response); 
            if (jsonResponse.status === "false") {
                window.location.href = '/account/signin'; 
            } else if (jsonResponse.status === "success") {
            	showNotification()
            	resetsize()
            	quantityInput.val(1);
            } else if (jsonResponse.status === "failed") {
                alert("Failed to add product to cart.");
            }
           
            
        },
        error: function(xhr, status, error) {
            alert("Đã xảy ra lỗi: " + error);
        }
    });
}
function addToCart(productId) {
    $.ajax({
        url: '/cart/addtocart',
        type: 'POST',
        data: {
            id: productId
        },
        success: function(response) {
           
            try {
                const jsonResponse = JSON.parse(response); 
                if (jsonResponse.status === "false") {
                    window.location.href = '/account/signin'; 
                } else if (jsonResponse.status === "success") {
                	showNotification()
 					resetsize()
                } else if (jsonResponse.status === "failed") {
                    alert("Failed to add product to cart.");
                }
            } catch (e) {
                console.error("An error occurred while processing the response: ", e);
                alert("An error occurred while adding product to cart.");
            }
        },
        error: function(xhr) {
            console.error("Error status: " + xhr.status); // In trạng thái lỗi
            console.error("Error response: " + xhr.responseText); // In nội dung phản hồi
            alert("An error occurred while adding product to cart.");
        }
    });
}
function resetsize() {
    $.ajax({
        url: '/cart/size',
        type: 'POST',
        success: function(response) {
           
            try {
                const jsonResponse = JSON.parse(response);
                const numberquantitycart = document.getElementById('numberquantitycart');
                numberquantitycart.innerHTML=jsonResponse.status
               
            } catch (e) {
            }
        },
        error: function(xhr) {
        }
    });
}
</script>
</html>